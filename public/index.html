<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="style.css" type="text/css" media="screen" charset="utf-8">
    <title>Twitter Realtime Map</title>
    <script src="socket.io.js" type="text/javascript"></script>
    <script src="rendermap.js" type="text/javascript"></script>
    <script type="text/javascript">
        function loaded() {
            var embers = [];
            var renderer = new Renderer();

            // An ember is an object with a few values:
            // x - x position
            // y - y position
            // age - the current age, from 0.0 to 1.0
            function makeEmber(x, y, age) {
                var ember = new Object();
                ember.x = x;
                ember.y = y;
                ember.age = age;
                return ember;
            }

            function addRandomEmbers() {
                var randomEmber = function() {
                    return makeEmber(Math.floor(Math.random() * renderer.width),
                        Math.floor(Math.random() * renderer.height), Math.random());
                }
                for (var i = 0; i < 10; i++) {
                    embers.push(randomEmber());
                }
            }

            embers.remove = function(from, to) {
                var rest = this.slice((to || from) + 1 || array.length);
                this.length = from < 0 ? this.length + from : from;
                return this.push.apply(this, rest);
            };

            function paintTimeout() {
                // Advance embers age.
                for (var i = 0; i < embers.length; i++) {
                    if (embers[i].age >= 1.0) {
                        embers.remove(i);
                        i--;
                    } else {
                        embers[i].age += 0.01;
                    }
                }

                addRandomEmbers();
                renderer.paint(embers);
            }

            paintTimeout();
            setInterval(paintTimeout, 100);
        }
    </script>
</head>
<body onload="loaded();">
    <div id="logo"><img src="tweenkle.png"></div>
    <!-- Node KO voting badge -->
    <a href="http://nodeknockout.com/teams/node-us" target="nko" title="Help me win Node.js KO!"><img style="position: fixed; top: 5px; right: 5px; border: 0px;" src="http://nodeknockout.com/images/voteko.png" alt="Help me win Node.js KO!" /></a>
</body>
</html>
